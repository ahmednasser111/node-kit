<%- include('partials/header') %>

<div class="page-header">
    <h1>üìÅ File Manager</h1>
    <p>Upload, download, or manage files on the server</p>
</div>

<% if (success) { %>
    <div class="alert alert-success">‚úÖ <%= success %></div>
<% } %>
<% if (error) { %>
    <div class="alert alert-error">‚ö†Ô∏è <%= error %></div>
<% } %>

<div class="grid-2">

    <div class="card">
        <h2>‚¨ÜÔ∏è Upload Single File</h2>
        <p class="card-desc">Max 5MB. Allowed: images, PDF, TXT, CSV.</p>

        <form action="/files/single" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <input type="file" name="myfile" class="file-input" required>
            </div>
            <button type="submit" class="btn-primary">Upload File</button>
        </form>
    </div>

    <div class="card">
        <h2>‚¨ÜÔ∏è‚¨ÜÔ∏è Upload Multiple Files</h2>
        <p class="card-desc">Select up to 5 files at once.</p>

        <form action="/files/multiple" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <input type="file" name="myfiles" class="file-input" multiple required>
            </div>
            <button type="submit" class="btn-primary">Upload Files</button>
        </form>
    </div>

</div>

<div class="card mt-2">
    <h2>üìã Uploaded Files (<%= files.length %>)</h2>

    <% if (files.length === 0) { %>
        <p class="empty-state">No files uploaded yet. Upload something above!</p>
    <% } else { %>
        <table class="files-table">
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Size</th>
                    <th>Uploaded</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% files.forEach(function(file) { %>
                    <tr>
                        <td>
                            <% const ext = file.name.split('.').pop().toLowerCase(); %>
                            <% const emoji = ext === 'pdf' ? 'üìÑ' :
                                            ['jpg','jpeg','png','gif'].includes(ext) ? 'üñºÔ∏è' :
                                            ext === 'csv' ? 'üìä' : 'üìù'; %>
                            <%= emoji %> <%= file.name %>
                        </td>
                        <td><%= file.size %></td>
                        <td><%= file.uploaded %></td>
                        <td class="actions">
                            <a href="/files/download/<%= encodeURIComponent(file.name) %>"
                               class="btn-sm btn-download">‚¨á Download</a>

                            <% if (user && user.role === 'admin') { %>
                                <a href="/files/delete/<%= encodeURIComponent(file.name) %>"
                                   class="btn-sm btn-danger"
                                   onclick="return confirm('Delete this file?')">üóë Delete</a>
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>
</div>

<%- include('partials/footer') %>
